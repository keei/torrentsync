#!/usr/bin/env ruby
# -*- coding: utf-8 -*-
self_file =
  if File.symlink?(__FILE__)
    require 'pathname'
    Pathname.new(__FILE__).realpath
  else
    __FILE__
  end
$:.unshift(File.dirname(self_file) + "/../lib")

require 'torrentsync'
require 'choice'

Choice.options do
  option :sync do
    short '-s'
  end
  option :dryrun do
    short '-n'
  end
end

c = Choice.choices
if c.sync
  peers = get_peers
  torrents, status = get_torrents(peers)
  dead_peers = status.select{|k,v| v == :dead}.map(&:first)
  sync_torrents(peers - dead_peers, torrents, 2, c.dryrun)
end
